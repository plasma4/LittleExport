/*
Copyright © 2025-2026 Leo Zhang

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
---
MIT License

Copyright (c) 2020 Kris Zyp

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CBOR={})}(this,(function(e){"use strict";let t,r,n;try{t=new TextDecoder}catch(e){}let i=0;const s={};let o,a,l,f,u,c,d,h=11281e4,y=1681e4,p={},g=0,w=0,b=[],m=[],A={useRecords:!1,mapsAsObjects:!0},v=!1,O=2;try{new Function("")}catch(e){O=1/0}class k{constructor(e){if(e&&(!e.keyMap&&!e._keyMap||e.useRecords||(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,r]of Object.entries(e.keyMap))this.mapKey.set(r,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,n]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,n);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey){this._mapKey=new Map;for(let[e,t]of Object.entries(this._keyMap))this._mapKey.set(t,e)}let t={};return e.forEach(((e,r)=>t[M(this._mapKey.has(r)?this._mapKey.get(r):r)]=e)),t}mapDecode(e,t){let r=this.decode(e);return this._keyMap&&"Array"===r.constructor.name?r.map((e=>this.decodeKeys(e))):r}decode(e,t){if(r)return H((()=>(Y(),this?this.decode(e,t):k.prototype.decode.call(A,e,t))));n=t>-1?t:e.length,i=0,w=0,a=null,l=null,r=e;try{c=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(r=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof k){if(p=this,u=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,E();(!o||o.length>0)&&(o=[])}else p=A,(!o||o.length>0)&&(o=[]),u=null;return E()}decodeMultiple(e,t){let r,n=0;try{let s=e.length;v=!0;let o=this?this.decode(e,s):Z.decode(e,s);if(!t){for(r=[o];i<s;)n=i,r.push(E());return r}if(!1===t(o))return;for(;i<s;)if(n=i,!1===t(E()))return}catch(e){throw e.lastPosition=n,e.values=r,e}finally{v=!1,Y()}}}function E(){try{let e=I();if(l){if(i>=l.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}i=l.postBundlePosition,l=null}if(i==n)o=null,r=null,f&&(f=null);else{if(i>n){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}if(!v)throw new Error("Data read, but end of buffer not reached")}return e}catch(e){throw Y(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function I(){let e=r[i++],t=e>>5;if(e&=31,e>23)switch(e){case 24:e=r[i++];break;case 25:if(7==t)return function(){let e=r[i++],t=r[i++],n=(127&e)>>2;if(31===n)return t||3&e?NaN:128&e?-1/0:1/0;if(0===n){let r=((3&e)<<8|t)/(1<<24);return 128&e?-r:r}return _[3]=128&e|56+(n>>1),_[2]=(7&e)<<5|t>>3,_[1]=t<<5,_[0]=0,P[0]}();e=c.getUint16(i),i+=2;break;case 26:if(7==t){let e=c.getFloat32(i);if(p.useFloat32>2){let t=q[(127&r[i])<<1|r[i+1]>>7];return i+=4,(t*e+(e>0?.5:-.5)>>0)/t}return i+=4,e}e=c.getUint32(i),i+=4;break;case 27:if(7==t){let e=c.getFloat64(i);return i+=8,e}if(t>1){if(c.getUint32(i)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=c.getUint32(i+4)}else p.int64AsNumber?(e=4294967296*c.getUint32(i),e+=c.getUint32(i+4)):e=c.getBigUint64(i);i+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e,r=[],n=0;for(;(e=I())!=s;){if(n>=h)throw new Error(`Array length exceeds ${h}`);r[n++]=e}return 4==t?r:3==t?r.join(""):Buffer.concat(r);case 5:let i;if(p.mapsAsObjects){let e={},t=0;if(p.keyMap)for(;(i=I())!=s;){if(t++>=y)throw new Error(`Property count exceeds ${y}`);e[M(p.decodeKey(i))]=I()}else for(;(i=I())!=s;){if(t++>=y)throw new Error(`Property count exceeds ${y}`);e[M(i)]=I()}return e}{d&&(p.mapsAsObjects=!0,d=!1);let e=new Map;if(p.keyMap){let t=0;for(;(i=I())!=s;){if(t++>=y)throw new Error(`Map size exceeds ${y}`);e.set(p.decodeKey(i),I())}}else{let t=0;for(;(i=I())!=s;){if(t++>=y)throw new Error(`Map size exceeds ${y}`);e.set(i,I())}}return e}case 7:return s;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return f=e,p.copyBuffers?Uint8Array.prototype.slice.call(r,i,i+=f):r.subarray(i,i+=f);case 3:if(w>=i)return a.slice(i-g,(i+=e)-g);if(0==w&&n<140&&e<32){let t=e<16?V(e):function(e){let t=i,n=new Array(e);for(let s=0;s<e;s++){const e=r[i++];if((128&e)>0)return void(i=t);n[s]=e}return B.apply(String,n)}(e);if(null!=t)return t}return x(e);case 4:if(e>=h)throw new Error(`Array length exceeds ${h}`);let t=new Array(e);for(let r=0;r<e;r++)t[r]=I();return t;case 5:if(e>=y)throw new Error(`Map size exceeds ${h}`);if(p.mapsAsObjects){let t={};if(p.keyMap)for(let r=0;r<e;r++)t[M(p.decodeKey(I()))]=I();else for(let r=0;r<e;r++)t[M(I())]=I();return t}{d&&(p.mapsAsObjects=!0,d=!1);let t=new Map;if(p.keyMap)for(let r=0;r<e;r++)t.set(p.decodeKey(I()),I());else for(let r=0;r<e;r++)t.set(I(),I());return t}case 6:if(e>=57337){let t=o[8191&e];if(t)return t.read||(t.read=S(t)),t.read();if(e<65536){if(57343==e){let e=$(),t=I(),r=I();F(t,r);let n={};if(p.keyMap)for(let t=2;t<e;t++){n[M(p.decodeKey(r[t-2]))]=I()}else for(let t=2;t<e;t++){n[M(r[t-2])]=I()}return n}if(57342==e){let e=$(),t=I();for(let r=2;r<e;r++)F(t++,I());return I()}if(57337==e)return function(){let e=$(),t=i+I();for(let t=2;t<e;t++){let e=$();i+=e}let r=i;return i=t,l=[j($()),j($())],l.position0=0,l.position1=0,l.postBundlePosition=i,i=r,I()}();if(p.getShared&&(J(),t=o[8191&e],t))return t.read||(t.read=S(t)),t.read()}}let s=b[e];if(s)return s.handlesRead?s(I):s(I());{let t=I();for(let r=0;r<m.length;r++){let n=m[r](e,t);if(void 0!==n)return n}return new R(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let t=(u||K())[e];if(void 0!==t)return t;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw new Error("Unknown CBOR token "+e)}var f}const U=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function S(e){if(!e)throw new Error("Structure is required in record definition");return e.slowReads=0,function(){let e=r[i++];if(e&=31,e>23)switch(e){case 24:e=r[i++];break;case 25:e=c.getUint16(i),i+=2;break;case 26:e=c.getUint32(i),i+=4;break;default:throw new Error("Expected array header, but got "+r[i-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(I);t=t.next}if(this.slowReads++>=O){let r=this.length==e?this:this.slice(0,e);return t=p.keyMap?new Function("r","return {"+r.map((e=>p.decodeKey(e))).map((e=>U.test(e)?M(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"):new Function("r","return {"+r.map((e=>U.test(e)?M(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(I)}let n={};if(p.keyMap)for(let t=0;t<e;t++)n[M(p.decodeKey(this[t]))]=I();else for(let t=0;t<e;t++)n[M(this[t])]=I();return n}}function M(e){if("string"==typeof e)return"__proto__"===e?"__proto_":e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";throw new Error("Invalid property name type "+typeof e)}let x=j;function j(e){let n;if(e<16&&(n=V(e)))return n;if(e>64&&t)return t.decode(r.subarray(i,i+=e));const s=i+e,o=[];for(n="";i<s;){const e=r[i++];if(0==(128&e))o.push(e);else if(192==(224&e)){const t=63&r[i++];o.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&r[i++],n=63&r[i++];o.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];t>65535&&(t-=65536,o.push(t>>>10&1023|55296),t=56320|1023&t),o.push(t)}else o.push(e);o.length>=4096&&(n+=B.apply(String,o),o.length=0)}return o.length>0&&(n+=B.apply(String,o)),n}let B=String.fromCharCode;function V(e){if(e<4){if(e<2){if(0===e)return"";{let e=r[i++];return(128&e)>1?void(i-=1):B(e)}}{let t=r[i++],n=r[i++];if((128&t)>0||(128&n)>0)return void(i-=2);if(e<3)return B(t,n);let s=r[i++];return(128&s)>0?void(i-=3):B(t,n,s)}}{let t=r[i++],n=r[i++],s=r[i++],o=r[i++];if((128&t)>0||(128&n)>0||(128&s)>0||(128&o)>0)return void(i-=4);if(e<6){if(4===e)return B(t,n,s,o);{let e=r[i++];return(128&e)>0?void(i-=5):B(t,n,s,o,e)}}if(e<8){let a=r[i++],l=r[i++];if((128&a)>0||(128&l)>0)return void(i-=6);if(e<7)return B(t,n,s,o,a,l);let f=r[i++];return(128&f)>0?void(i-=7):B(t,n,s,o,a,l,f)}{let a=r[i++],l=r[i++],f=r[i++],u=r[i++];if((128&a)>0||(128&l)>0||(128&f)>0||(128&u)>0)return void(i-=8);if(e<10){if(8===e)return B(t,n,s,o,a,l,f,u);{let e=r[i++];return(128&e)>0?void(i-=9):B(t,n,s,o,a,l,f,u,e)}}if(e<12){let c=r[i++],d=r[i++];if((128&c)>0||(128&d)>0)return void(i-=10);if(e<11)return B(t,n,s,o,a,l,f,u,c,d);let h=r[i++];return(128&h)>0?void(i-=11):B(t,n,s,o,a,l,f,u,c,d,h)}{let c=r[i++],d=r[i++],h=r[i++],y=r[i++];if((128&c)>0||(128&d)>0||(128&h)>0||(128&y)>0)return void(i-=12);if(e<14){if(12===e)return B(t,n,s,o,a,l,f,u,c,d,h,y);{let e=r[i++];return(128&e)>0?void(i-=13):B(t,n,s,o,a,l,f,u,c,d,h,y,e)}}{let p=r[i++],g=r[i++];if((128&p)>0||(128&g)>0)return void(i-=14);if(e<15)return B(t,n,s,o,a,l,f,u,c,d,h,y,p,g);let w=r[i++];return(128&w)>0?void(i-=15):B(t,n,s,o,a,l,f,u,c,d,h,y,p,g,w)}}}}}let P=new Float32Array(1),_=new Uint8Array(P.buffer,0,4);new Array(4096);class R{constructor(e,t){this.value=e,this.tag=t}}b[0]=e=>new Date(e),b[1]=e=>new Date(Math.round(1e3*e)),b[2]=e=>{let t=BigInt(0);for(let r=0,n=e.byteLength;r<n;r++)t=BigInt(e[r])+(t<<BigInt(8));return t},b[3]=e=>BigInt(-1)-b[2](e),b[4]=e=>+(e[1]+"e"+e[0]),b[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const F=(e,t)=>{let r=o[e-=57344];r&&r.isShared&&((o.restoreStructures||(o.restoreStructures=[]))[e]=r),o[e]=t,t.read=S(t)};b[105]=e=>{let t=e.length,r=e[1];F(e[0],r);let n={};for(let i=2;i<t;i++){n[M(r[i-2])]=e[i]}return n},b[14]=e=>l?l[0].slice(l.position0,l.position0+=e):new R(e,14),b[15]=e=>l?l[1].slice(l.position1,l.position1+=e):new R(e,15);let T={Error:Error,RegExp:RegExp};b[27]=e=>(T[e[0]]||Error)(e[1],e[2]);const D=e=>{if(132!=r[i++]){let e=new Error("Packed values structure must be followed by a 4 element array");throw r.length<i&&(e.incomplete=!0),e}let t=e();if(!t||!t.length){let e=new Error("Packed values structure must be followed by a 4 element array");throw e.incomplete=!0,e}return u=u?t.concat(u.slice(t.length)):t,u.prefixes=e(),u.suffixes=e(),e()};function N(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function K(){if(!u){if(!p.getShared)throw new Error("No packed values available");J()}return u}D.handlesRead=!0,b[51]=D,b[6]=e=>{if(!u){if(!p.getShared)return new R(e,6);J()}if("number"==typeof e)return u[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw void 0===e&&(t.incomplete=!0),t},b[28]=e=>{f||(f=new Map,f.id=0);let t,n=f.id++,s=i;t=r[i]>>5==4?[]:{};let o={target:t};f.set(n,o);let a=e();return o.used?(Object.getPrototypeOf(t)!==Object.getPrototypeOf(a)&&(i=s,t=a,f.set(n,{target:t}),a=e()),Object.assign(t,a)):(o.target=a,a)},b[28].handlesRead=!0,b[29]=e=>{let t=f.get(e);return t.used=!0,t.target},b[258]=e=>new Set(e),(b[259]=e=>(p.mapsAsObjects&&(p.mapsAsObjects=!1,d=!0),e())).handlesRead=!0;m.push(((e,t)=>e>=225&&e<=255?N(K().prefixes[e-224],t):e>=28704&&e<=32767?N(K().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?N(K().prefixes[e-1879048192],t):e>=216&&e<=223?N(t,K().suffixes[e-216]):e>=27647&&e<=28671?N(t,K().suffixes[e-27639]):e>=1811940352&&e<=1879048191?N(t,K().suffixes[e-1811939328]):1399353956==e?{packedValues:u,structures:o.slice(0),version:t}:55799==e?t:void 0));const C=1==new Uint8Array(new Uint16Array([1]).buffer)[0],z=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],L=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<z.length;e++)W(z[e],L[e]);function W(e,t){let r,n="get"+e.name.slice(0,-5);"function"==typeof e?r=e.BYTES_PER_ELEMENT:e=null;for(let i=0;i<2;i++){if(!i&&1==r)continue;let s=2==r?1:4==r?2:8==r?3:0;b[i?t:t-4]=1==r||i==C?n=>{if(!e)throw new Error("Could not find typed array for code "+t);return p.copyBuffers||1!==r&&(2!==r||1&n.byteOffset)&&(4!==r||3&n.byteOffset)&&(8!==r||7&n.byteOffset)?new e(Uint8Array.prototype.slice.call(n,0).buffer):new e(n.buffer,n.byteOffset,n.byteLength>>s)}:r=>{if(!e)throw new Error("Could not find typed array for code "+t);let o=new DataView(r.buffer,r.byteOffset,r.byteLength),a=r.length>>s,l=new e(a),f=o[n];for(let e=0;e<a;e++)l[e]=f.call(o,e<<s,i);return l}}}function $(){let e=31&r[i++];if(e>23)switch(e){case 24:e=r[i++];break;case 25:e=c.getUint16(i),i+=2;break;case 26:e=c.getUint32(i),i+=4}return e}function J(){if(p.getShared){let e=H((()=>(r=null,p.getShared())))||{},t=e.structures||[];p.sharedVersion=e.version,u=p.sharedValues=e.packedValues,!0===o?p.structures=o=t:o.splice.apply(o,[0,t.length].concat(t))}}function H(e){let t=n,s=i,u=g,d=w,h=a,y=f,b=l,m=new Uint8Array(r.slice(0,n)),A=o,O=p,k=v,E=e();return n=t,i=s,g=u,w=d,a=h,f=y,l=b,r=m,v=k,o=A,p=O,c=new DataView(r.buffer,r.byteOffset,r.byteLength),E}function Y(){r=null,f=null,o=null}const q=new Array(147);for(let e=0;e<256;e++)q[e]=+("1e"+Math.floor(45.15-.30103*e));let Z=new k({useRecords:!1});const G=Z.decode,Q=Z.decodeMultiple,X={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let ee,te,re;try{ee=new TextEncoder}catch(e){}const ne="object"==typeof globalThis&&globalThis.Buffer,ie=void 0!==ne,se=ie?ne.allocUnsafeSlow:Uint8Array,oe=ie?ne:Uint8Array,ae=ie?4294967296:2144337920;let le,fe,ue,ce,de=0,he=null;const ye=/[\u0080-\uFFFF]/,pe=Symbol("record-id");class ge extends k{constructor(e){let t,r,n,i,s;super(e),this.offset=0,e=e||{};let o=oe.prototype.utf8Write?function(e,t,r){return fe.utf8Write(e,t,r)}:!(!ee||!ee.encodeInto)&&function(e,t){return ee.encodeInto(e,fe.subarray(t)).written},a=this,l=e.structures||e.saveStructures,f=e.maxSharedStructures;if(null==f&&(f=l?128:0),f>8190)throw new Error("Maximum maxSharedStructure is 8190");let u=e.sequential;u&&(f=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let c,d,h,y=e.sharedValues;if(y){h=Object.create(null);for(let e=0,t=y.length;e<t;e++)h[y[e]]=e}let p=[],g=0,w=0;this.mapEncode=function(e,t){if(this._keyMap&&!this._mapped&&"Array"===e.constructor.name)e=e.map((e=>this.encodeKeys(e)));return this.encode(e,t)},this.encode=function(o,l){if(fe||(fe=new se(8192),ue=new DataView(fe.buffer,0,8192),de=0),ce=fe.length-10,ce-de<2048?(fe=new se(fe.length),ue=new DataView(fe.buffer,0,fe.length),ce=fe.length-10,de=0):l===Re&&(de=de+7&2147483640),t=de,a.useSelfDescribedHeader&&(ue.setUint32(de,3654940416),de+=3),s=a.structuredClone?new Map:null,a.bundleStrings&&"string"!=typeof o?(he=[],he.size=1/0):he=null,r=a.structures,r){if(r.uninitialized){let e=a.getShared()||{};a.structures=r=e.structures||[],a.sharedVersion=e.version;let t=a.sharedValues=e.packedValues;if(t){h={};for(let e=0,r=t.length;e<r;e++)h[t[e]]=e}}let e=r.length;if(e>f&&!u&&(e=f),!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,i=r.transitions;for(let r=0,s=e.length;r<s;r++){void 0===i[pe]&&(i[pe]=t);let s=e[r];n=i[s],n||(n=i[s]=Object.create(null)),i=n}i[pe]=1048576|t}}u||(r.nextId=e)}if(n&&(n=!1),i=r||[],d=h,e.pack){let t=new Map;if(t.values=[],t.encoder=a,t.maxValues=e.maxPrivatePackedValues||(h?16:1/0),t.objectMap=h||!1,t.samplingPackedValues=c,Oe(o,t),t.values.length>0){fe[de++]=216,fe[de++]=51,me(4);let e=t.values;b(e),me(0),me(0),d=Object.create(h||null);for(let t=0,r=e.length;t<r;t++)d[e[t]]=t}}le=l&Te;try{if(le)return;if(b(o),he&&Ue(t,b),a.offset=de,s&&s.idsToInsert){de+=2*s.idsToInsert.length,de>ce&&A(de),a.offset=de;let e=function(e,t){let r,n=2*t.length,i=e.length-n;t.sort(((e,t)=>e.offset>t.offset?1:-1));for(let r=0;r<t.length;r++){let n=t[r];n.id=r;for(let t of n.references)e[t++]=r>>8,e[t]=255&r}for(;r=t.pop();){let t=r.offset;e.copyWithin(t+n,t,i),n-=2;let s=t+n;e[s++]=216,e[s++]=28,i=t}return e}(fe.subarray(t,de),s.idsToInsert);return s=null,e}return l&Re?(fe.start=t,fe.end=de,fe):fe.subarray(t,de)}finally{if(r)if(w<10&&w++,r.length>f&&(r.length=f),g>1e4)r.transitions=null,w=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!u){for(let e=0,t=p.length;e<t;e++)p[e][pe]=void 0;p=[]}if(n&&a.saveShared){a.structures.length>f&&(a.structures=a.structures.slice(0,f));let e=fe.subarray(t,de);return!1===a.updateSharedData()?a.encode(o):e}l&Fe&&(de=t)}},this.findCommonStringsToPack=()=>(c=new Map,h||(h=Object.create(null)),e=>{let t=e&&e.threshold||4,r=this.pack?e.maxPrivatePackedValues||16:0;y||(y=this.sharedValues=[]);for(let[e,i]of c)i.count>t&&(h[e]=r++,y.push(e),n=!0);for(;this.saveShared&&!1===this.updateSharedData(););c=null});const b=r=>{de>ce&&(fe=A(de));var n,i=typeof r;if("string"===i){if(d){let t=d[r];if(t>=0)return void(t<16?fe[de++]=t+224:(fe[de++]=198,b(1&t?15-t>>1:t-16>>1)));if(c&&!e.pack){let e=c.get(r);e?e.count++:c.set(r,{count:1})}}let i,s=r.length;if(he&&s>=4&&s<1024){if((he.size+=s)>61440){let e,r=(he[0]?3*he[0].length+he[1].length:0)+10;de+r>ce&&(fe=A(de+r)),fe[de++]=217,fe[de++]=223,fe[de++]=249,fe[de++]=he.position?132:130,fe[de++]=26,e=de-t,de+=4,he.position&&Ue(t,b),he=["",""],he.size=0,he.position=e}let e=ye.test(r);return he[e?0:1]+=r,fe[de++]=e?206:207,void b(s)}i=s<32?1:s<256?2:s<65536?3:5;let a=3*s;if(de+a>ce&&(fe=A(de+a)),s<64||!o){let e,t,o,a=de+i;for(e=0;e<s;e++)t=r.charCodeAt(e),t<128?fe[a++]=t:t<2048?(fe[a++]=t>>6|192,fe[a++]=63&t|128):55296==(64512&t)&&56320==(64512&(o=r.charCodeAt(e+1)))?(t=65536+((1023&t)<<10)+(1023&o),e++,fe[a++]=t>>18|240,fe[a++]=t>>12&63|128,fe[a++]=t>>6&63|128,fe[a++]=63&t|128):(fe[a++]=t>>12|224,fe[a++]=t>>6&63|128,fe[a++]=63&t|128);n=a-de-i}else n=o(r,de+i,a);n<24?fe[de++]=96|n:n<256?(i<2&&fe.copyWithin(de+2,de+1,de+1+n),fe[de++]=120,fe[de++]=n):n<65536?(i<3&&fe.copyWithin(de+3,de+2,de+2+n),fe[de++]=121,fe[de++]=n>>8,fe[de++]=255&n):(i<5&&fe.copyWithin(de+5,de+3,de+3+n),fe[de++]=122,ue.setUint32(de,n),de+=4),de+=n}else if("number"===i)if(this.alwaysUseFloat||r>>>0!==r)if(this.alwaysUseFloat||r>>0!==r){let e;if((e=this.useFloat32)>0&&r<4294967296&&r>=-2147483648){let t;if(fe[de++]=250,ue.setFloat32(de,r),e<4||(t=r*q[(127&fe[de])<<1|fe[de+1]>>7])>>0===t)return void(de+=4);de--}fe[de++]=251,ue.setFloat64(de,r),de+=8}else r>=-24?fe[de++]=31-r:r>=-256?(fe[de++]=56,fe[de++]=~r):r>=-65536?(fe[de++]=57,ue.setUint16(de,~r),de+=2):(fe[de++]=58,ue.setUint32(de,~r),de+=4);else r<24?fe[de++]=r:r<256?(fe[de++]=24,fe[de++]=r):r<65536?(fe[de++]=25,fe[de++]=r>>8,fe[de++]=255&r):(fe[de++]=26,ue.setUint32(de,r),de+=4);else if("object"===i)if(r){if(s){let e=s.get(r);if(e){if(fe[de++]=216,fe[de++]=29,fe[de++]=25,!e.references){let t=s.idsToInsert||(s.idsToInsert=[]);e.references=[],t.push(e)}return e.references.push(de-t),void(de+=2)}s.set(r,{offset:de-t})}let e=r.constructor;if(e===Object)m(r);else if(e===Array){(n=r.length)<24?fe[de++]=128|n:me(n);for(let e=0;e<n;e++)b(r[e])}else if(e===Map)if((this.mapsAsObjects?!1!==this.useTag259ForMaps:this.useTag259ForMaps)&&(fe[de++]=217,fe[de++]=1,fe[de++]=3),(n=r.size)<24?fe[de++]=160|n:n<256?(fe[de++]=184,fe[de++]=n):n<65536?(fe[de++]=185,fe[de++]=n>>8,fe[de++]=255&n):(fe[de++]=186,ue.setUint32(de,n),de+=4),a.keyMap)for(let[e,t]of r)b(a.encodeKey(e)),b(t);else for(let[e,t]of r)b(e),b(t);else{for(let e=0,t=te.length;e<t;e++){if(r instanceof re[e]){let t=te[e],n=t.tag;return null==n&&(n=t.getTag&&t.getTag.call(this,r)),n<24?fe[de++]=192|n:n<256?(fe[de++]=216,fe[de++]=n):n<65536?(fe[de++]=217,fe[de++]=n>>8,fe[de++]=255&n):n>-1&&(fe[de++]=218,ue.setUint32(de,n),de+=4),void t.encode.call(this,r,b,A)}}if(r[Symbol.iterator]){if(le){let e=new Error("Iterable should be serialized as iterator");throw e.iteratorNotHandled=!0,e}fe[de++]=159;for(let e of r)b(e);return void(fe[de++]=255)}if(r[Symbol.asyncIterator]||ve(r)){let e=new Error("Iterable/blob should be serialized as iterator");throw e.iteratorNotHandled=!0,e}if(this.useToJSON&&r.toJSON){const e=r.toJSON();if(e!==r)return b(e)}m(r)}}else fe[de++]=246;else if("boolean"===i)fe[de++]=r?245:244;else if("bigint"===i){if(r<BigInt(1)<<BigInt(64)&&r>=0)fe[de++]=27,ue.setBigUint64(de,r);else if(r>-(BigInt(1)<<BigInt(64))&&r<0)fe[de++]=59,ue.setBigUint64(de,-r-BigInt(1));else{if(!this.largeBigIntToFloat){r>=BigInt(0)?fe[de++]=194:(fe[de++]=195,r=BigInt(-1)-r);let e=[];for(;r;)e.push(Number(r&BigInt(255))),r>>=BigInt(8);return void Ie(new Uint8Array(e.reverse()),A)}fe[de++]=251,ue.setFloat64(de,Number(r))}de+=8}else{if("undefined"!==i)throw new Error("Unknown type: "+i);fe[de++]=247}},m=!1===this.useRecords?this.variableMapSize?e=>{let t=Object.keys(e),r=Object.values(e),n=t.length;if(n<24?fe[de++]=160|n:n<256?(fe[de++]=184,fe[de++]=n):n<65536?(fe[de++]=185,fe[de++]=n>>8,fe[de++]=255&n):(fe[de++]=186,ue.setUint32(de,n),de+=4),a.keyMap)for(let e=0;e<n;e++)b(a.encodeKey(t[e])),b(r[e]);else for(let e=0;e<n;e++)b(t[e]),b(r[e])}:e=>{fe[de++]=185;let r=de-t;de+=2;let n=0;if(a.keyMap)for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(a.encodeKey(t)),b(e[t]),n++);else for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(t),b(e[t]),n++);fe[r+++t]=n>>8,fe[r+t]=255&n}:(e,t)=>{let r,s,o,a=i.transitions||(i.transitions=Object.create(null)),l=0,u=0;if(this.keyMap){o=Object.keys(e).map((e=>this.encodeKey(e))),u=o.length;for(let e=0;e<u;e++){let t=o[e];r=a[t],r||(r=a[t]=Object.create(null),l++),a=r}}else for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(r=a[t],r||(1048576&a[pe]&&(s=65535&a[pe]),r=a[t]=Object.create(null),l++),a=r,u++);let c=a[pe];if(void 0!==c)c&=65535,fe[de++]=217,fe[de++]=c>>8|224,fe[de++]=255&c;else{if(o||(o=a.__keys__||(a.__keys__=Object.keys(e))),void 0===s?(c=i.nextId++,c||(c=0,i.nextId=1),c>=256&&(i.nextId=(c=f)+1)):c=s,i[c]=o,!(c<f)){if(a[pe]=c,ue.setUint32(de,3655335680),de+=3,l&&(g+=w*l),p.length>=256-f&&(p.shift()[pe]=void 0),p.push(a),me(u+2),b(57344+c),b(o),t)return;for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&b(e[t]);return}fe[de++]=217,fe[de++]=c>>8|224,fe[de++]=255&c,a=i.transitions;for(let e=0;e<u;e++)(void 0===a[pe]||1048576&a[pe])&&(a[pe]=c),a=a[o[e]];a[pe]=1048576|c,n=!0}if(u<24?fe[de++]=128|u:me(u),!t)for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&b(e[t])},A=e=>{let r;if(e>16777216){if(e-t>ae)throw new Error("Encoded buffer would be larger than maximum buffer size");r=Math.min(ae,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=1+(Math.max(e-t<<2,fe.length-1)>>12)<<12;let n=new se(r);return ue=new DataView(n.buffer,0,r),fe.copy?fe.copy(n,0,t,e):n.set(fe.slice(t,e)),de-=t,t=0,ce=n.length-10,fe=n};let v=100,O=1e3;function*k(e,r,n){let i=e.constructor;if(i===Object){let t=!1!==a.useRecords;t?m(e,!0):we(Object.keys(e).length,160);for(let n in e){let i=e[n];t||b(n),i&&"object"==typeof i?r[n]?yield*k(i,r[n]):yield*E(i,r,n):b(i)}}else if(i===Array){let n=e.length;me(n);for(let i=0;i<n;i++){let n=e[i];n&&("object"==typeof n||de-t>v)?r.element?yield*k(n,r.element):yield*E(n,r,"element"):b(n)}}else if(e[Symbol.iterator]&&!e.buffer){fe[de++]=159;for(let n of e)n&&("object"==typeof n||de-t>v)?r.element?yield*k(n,r.element):yield*E(n,r,"element"):b(n);fe[de++]=255}else ve(e)?(we(e.size,64),yield fe.subarray(t,de),yield e,I()):e[Symbol.asyncIterator]?(fe[de++]=159,yield fe.subarray(t,de),yield e,I(),fe[de++]=255):b(e);n&&de>t?yield fe.subarray(t,de):de-t>v&&(yield fe.subarray(t,de),I())}function*E(e,r,n){let i=de-t;try{b(e),de-t>v&&(yield fe.subarray(t,de),I())}catch(s){if(!s.iteratorNotHandled)throw s;r[n]={},de=t+i,yield*k.call(this,e,r[n])}}function I(){v=O,a.encode(null,Te)}function U(e,t,r){return v=t&&t.chunkThreshold?O=t.chunkThreshold:100,e&&"object"==typeof e?(a.encode(null,Te),r(e,a.iterateProperties||(a.iterateProperties={}),!0)):[a.encode(e)]}async function*S(e,t){for(let r of k(e,t,!0)){let e=r.constructor;if(e===oe||e===Uint8Array)yield r;else if(ve(r)){let e,t=r.stream().getReader();for(;!(e=await t.read()).done;)yield e.value}else if(r[Symbol.asyncIterator])for await(let e of r)I(),e?yield*S(e,t.async||(t.async={})):yield a.encode(e);else yield r}}this.encodeAsIterable=function(e,t){return U(e,t,k)},this.encodeAsAsyncIterable=function(e,t){return U(e,t,S)}}useBuffer(e){fe=e,ue=new DataView(fe.buffer,fe.byteOffset,fe.byteLength),de=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new be(t,this.sharedValues,this.sharedVersion),n=this.saveShared(r,(t=>(t&&t.version||0)==e));return!1===n?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach(((e,t)=>this.structures[t]=e)),n}}function we(e,t){e<24?fe[de++]=t|e:e<256?(fe[de++]=24|t,fe[de++]=e):e<65536?(fe[de++]=25|t,fe[de++]=e>>8,fe[de++]=255&e):(fe[de++]=26|t,ue.setUint32(de,e),de+=4)}class be{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function me(e){e<24?fe[de++]=128|e:e<256?(fe[de++]=152,fe[de++]=e):e<65536?(fe[de++]=153,fe[de++]=e>>8,fe[de++]=255&e):(fe[de++]=154,ue.setUint32(de,e),de+=4)}const Ae="undefined"==typeof Blob?function(){}:Blob;function ve(e){if(e instanceof Ae)return!0;let t=e[Symbol.toStringTag];return"Blob"===t||"File"===t}function Oe(e,t){switch(typeof e){case"string":if(e.length>3){if(t.objectMap[e]>-1||t.values.length>=t.maxValues)return;let r=t.get(e);if(r)2==++r.count&&t.values.push(e);else if(t.set(e,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(e);r?r.count++:t.samplingPackedValues.set(e,{count:1})}}break;case"object":if(e)if(e instanceof Array)for(let r=0,n=e.length;r<n;r++)Oe(e[r],t);else{let n=!t.encoder.useRecords;for(var r in e)e.hasOwnProperty(r)&&(n&&Oe(r,t),Oe(e[r],t))}break;case"function":console.log(e)}}const ke=1==new Uint8Array(new Uint16Array([1]).buffer)[0];function Ee(e,t){return!ke&&t>1&&(e-=4),{tag:e,encode:function(e,t){let r=e.byteLength,n=e.byteOffset||0,i=e.buffer||e;t(ie?ne.from(i,n,r):new Uint8Array(i,n,r))}}}function Ie(e,t){let r=e.byteLength;r<24?fe[de++]=64+r:r<256?(fe[de++]=88,fe[de++]=r):r<65536?(fe[de++]=89,fe[de++]=r>>8,fe[de++]=255&r):(fe[de++]=90,ue.setUint32(de,r),de+=4),de+r>=fe.length&&t(de+r),fe.set(e.buffer?e:new Uint8Array(e),de),de+=r}function Ue(e,t){ue.setUint32(he.position+e,de-he.position-e+1);let r=he;he=null,t(r[0]),t(r[1])}re=[Date,Set,Error,RegExp,R,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?function(){}:BigInt64Array,Float32Array,Float64Array,be],te=[{tag:1,encode(e,t){let r=e.getTime()/1e3;(this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296?(fe[de++]=26,ue.setUint32(de,r),de+=4):(fe[de++]=251,ue.setFloat64(de,r),de+=8)}},{tag:258,encode(e,t){t(Array.from(e))}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag:e=>e.tag,encode(e,t){t(e.value)}},{encode(e,t,r){Ie(e,r)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||ie&&!1!==this.tagUint8Array))return 64},encode(e,t,r){Ie(e,r)}},Ee(68,1),Ee(69,2),Ee(70,4),Ee(71,8),Ee(72,1),Ee(77,2),Ee(78,4),Ee(79,8),Ee(85,4),Ee(86,8),{encode(e,t){let r=e.packedValues||[],n=e.structures||[];if(r.values.length>0){fe[de++]=216,fe[de++]=51,me(4);let e=r.values;t(e),me(0),me(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let t=0,r=e.length;t<r;t++)packedObjectMap[e[t]]=t}if(n){ue.setUint32(de,3655335424),de+=3;let r=n.slice(0);r.unshift(57344),r.push(new R(e.version,1399353956)),t(r)}else t(new R(e.version,1399353956))}}];let Se=new ge({useRecords:!1});const Me=Se.encode,xe=Se.encodeAsIterable,je=Se.encodeAsAsyncIterable,{NEVER:Be,ALWAYS:Ve,DECIMAL_ROUND:Pe,DECIMAL_FIT:_e}=X,Re=512,Fe=1024,Te=2048;e.ALWAYS=Ve,e.DECIMAL_FIT=_e,e.DECIMAL_ROUND=Pe,e.Decoder=k,e.Encoder=ge,e.FLOAT32_OPTIONS=X,e.NEVER=Be,e.REUSE_BUFFER_MODE=Re,e.Tag=R,e.addExtension=function(e){if(e.Class){if(!e.encode)throw new Error("Extension has no encode function");re.unshift(e.Class),te.unshift(e)}!function(e){b[e.tag]=e.decode}(e)},e.clearSource=Y,e.decode=G,e.decodeIter=function(e,t={}){if(!e||"object"!=typeof e)throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const r=new k(t);let n;const i=e=>{let t;n&&(e=Buffer.concat([n,e]),n=void 0);try{t=r.decodeMultiple(e)}catch(r){if(!r.incomplete)throw r;n=e.slice(r.lastPosition),t=r.values}return t};return"function"==typeof e[Symbol.iterator]?function*(){for(const t of e)yield*i(t)}():"function"==typeof e[Symbol.asyncIterator]?async function*(){for await(const t of e)yield*i(t)}():void 0},e.decodeMultiple=Q,e.encode=Me,e.encodeAsAsyncIterable=je,e.encodeAsIterable=xe,e.encodeIter=function(e,t={}){if(e&&"object"==typeof e){if("function"==typeof e[Symbol.iterator])return function*(e,t){const r=new ge(t);for(const t of e)yield r.encode(t)}(e,t);if("function"==typeof e.then||"function"==typeof e[Symbol.asyncIterator])return async function*(e,t){const r=new ge(t);for await(const t of e)yield r.encode(t)}(e,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable")},e.isNativeAccelerationEnabled=!1,e.roundFloat32=function(e){P[0]=e;let t=q[(127&_[3])<<1|_[2]>>7];return(t*e+(e>0?.5:-.5)>>0)/t},e.setSizeLimits=function(e){e.maxMapSize&&(y=e.maxMapSize),e.maxArraySize&&(h=e.maxArraySize),e.maxObjectSize&&e.maxObjectSize}}));
(function(){function e(e=100){async function t(){"scheduler"in window&&"yield"in scheduler?await scheduler.yield():await new Promise(e=>{o.push(e),a.port2.postMessage(null)}),r=Date.now(),n=null}let r=0,n=null;const a=new MessageChannel,o=[];return a.port1.onmessage=()=>o.shift()?.(),function(a=!1){const o=Date.now();return!a&&o-r<=e?null:(n||(n=t()),n)}}async function t(e,t){const r=await crypto.subtle.importKey("raw",p.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:6e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}function r(e,r,n){const{include:a,exclude:o}=n;if(o&&o[e]){const t=o[e];if("function"==typeof t){if(t(r))return!1;}else if(Array.isArray(t)&&t.some(e=>r===e||r.startsWith(e+"/")))return!1}if(a&&a[e]){const t=a[e];if("function"==typeof t)return t(r);if(Array.isArray(t)&&0<t.length)return t.some(e=>r===e||r.startsWith(e+"/"))}return!0}function n(e,t,r=new WeakMap,n=new Map){if(!e||"object"!=typeof e)return e;if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||e instanceof Date)return e;if(r.has(e))return r.get(e);if(e instanceof Blob){if(n.has(e))return n.get(e);const r=(h++).toString(16);t.push({uuid:r,blob:e});const a={__le_blob_ref:r,type:e.type,size:e.size};return n.set(e,a),a}let a;if(Array.isArray(e)){const o=Object.keys(e),i=o.length<e.length||o.some(e=>isNaN(e));if(i){a={__le_sparse:!0,length:e.length,data:{}},r.set(e,a);for(const i of o)a.data[i]=LittleExport.prepForCBOR(e[i],t,r,n)}else{a=Array(e.length),r.set(e,a);for(let o=0;o<e.length;o++)a[o]=LittleExport.prepForCBOR(e[o],t,r,n)}}else for(const o in a={},r.set(e,a),e)Object.prototype.hasOwnProperty.call(e,o)&&(a[o]=LittleExport.prepForCBOR(e[o],t,r,n));return a}async function a(e,t){if(!e||"object"!=typeof e)return e;if(e.__le_blob_ref){if(!t)return null;try{const r=await t.getFileHandle(e.__le_blob_ref),n=await r.getFile();return n.slice(0,n.size,e.type)}catch(t){return null}}if(e.__le_sparse){const r=Array(e.length);for(const n in e.data)r[n]=await a(e.data[n],t);return r}if(Array.isArray(e)){const r=Array(e.length);for(let n=0;n<e.length;n++)r[n]=await LittleExport.restoreFromCBOR(e[n],t);return r}if(e.constructor===Object){const r={};for(const n in e)r[n]=await LittleExport.restoreFromCBOR(e[n],t);return r}return e}function o(e,t){const r=new TextEncoder;let n=new Uint8Array(0);const a=(e,t)=>{if(null==t)return;const a=` ${e}=${t+""}\n`,o=r.encode(a);let i=o.length,s=i+"";for(;;){const e=o.length+s.length;if(e===i)break;i=e,s=i+""}const d=r.encode(`${s}${a}`),l=new Uint8Array(n.length+d.length);l.set(n),l.set(d,n.length),n=l};return a("path",e),8589934591<t&&a("size",t),n}function i(e,t,r,n="0",a="000644"){const o=8589934591<t?0:t,s=k.slice(0);s[156]=n.charCodeAt(0);const d=p.encode(e),l=Math.min(d.length,100);s.set(d.subarray(0,l),0),a&&p.encodeInto(a.padEnd(7,"\0"),s.subarray(100,108));const c=(e,t,r)=>{const n=Math.floor(e).toString(8).padStart(r-1,"0");n.length>=r||(p.encodeInto(n,s.subarray(t,t+r-1)),s[t+r-1]=0)};c(o,124,12),c(r,136,12);let u=0;for(let o=0;512>o;o++)u+=s[o];const f=u.toString(8).padStart(6,"0");return p.encodeInto(f,s.subarray(148)),s[154]=0,s[155]=32,s}function s(e){const t=b.decode(e.slice(148,156)).replace(/\0/g,"").trim(),r=parseInt(t,8);if(isNaN(r))return!1;let n=0;for(let t=0;512>t;t++)n+=148<=t&&156>t?32:e[t];return n===r}async function d(t={}){function n(e,t,r){return w?T(e,t,r):f.TRUST}async function a(e,t){try{return await e()}catch(r){if(l.onerror&&l.onerror(r),y(`Error: ${t} - ${r.message}`),!k)throw r;return null}}async function o(e,t,a,o){if(P)return!1;if(void 0===F[o])if(w){let t=n(e);if(t&&"function"==typeof t.then&&(t=await t),F[o]=t,F[o]===f.ABORT)return P=!0,!1}else F[o]=f.TRUST;if(F[o]===f.SKIP)return!1;if(F[o]===f.TRUST)return!0;if(w&&t){I[o]||(I[o]=new Set);for(let e=1;e<=t.length;e++){const r=t.slice(0,e).join("/");if(I[o].has(r))return!0}let r=n(e,t,null);return(r&&"function"==typeof r.then&&(r=await r),r===f.ABORT)?(P=!0,!1):r!==f.SKIP&&(r===f.TRUST&&I[o].add(t.join("/")),!0)}return!!w||r(o,a,l)}const i=window.CBOR,l={logSpeed:100,...t},c=l.decoder||new i.Decoder({structuredClone:!0,bundleStrings:!0,copyBuffers:!1,...l.cborOptions}),h=l.cborExtensionName;let g=l.source;if(!g)throw new Error("No source provided. Pass a URL, Blob, or File via the source config property.");const y=l.logger||(()=>{}),S=e(l.logSpeed),k=!1!==l.graceful,w="function"==typeof l.onVisit,T=l.onVisit;let P=!1,E=null;const F={},I={};let C={category:"",detail:""};const v={};let B=!1;try{async function e(e){for(;!W.has(e)&&!N;){const{value:e,done:t}=await _.read();t?N=!0:W.push(e)}return W.has(e)}async function d(t){for(let r=t;0<r&&(0!==W.totalSize||N||(await e(1)),0!==W.totalSize);){const e=Math.min(r,W.totalSize);W.read(e),r-=e}}async function p(e,t){try{for(let r=t;0<r;){const n=S();if(n){let e=`Importing ${C.category}: ${(L/1e6).toFixed(2)} MB`;e+=1e6<t?` (${C.detail}: ${((t-r)/1e6).toFixed(1)}/${(t/1e6).toFixed(1)} MB)`:` (${C.detail})`,y(e),await n}if(0<W.totalSize){const t=Math.min(r,W.totalSize);await W.consume(t,async t=>{await e.write(t),r-=t.byteLength})}else{let{value:t,done:n}=await _.read();if(n)throw new Error("Unexpected EOF.");t.byteLength<=r?(await e.write(t),r-=t.byteLength):(await e.write(t.subarray(0,r)),W.push(t.subarray(r)),r=0)}}}finally{try{await e.close()}catch(t){}}}function k(e){const t={};for(let r=0;r<e.length;){let n=-1;for(let t=r;t<e.length;t++)if(32===e[t]){n=t;break}if(-1===n)break;const a=b.decode(e.subarray(r,n)),o=parseInt(a,10);if(isNaN(o))break;const i=e.subarray(r,r+o),s=b.decode(i),d=s.indexOf("=");if(-1!==d){const e=s.indexOf(" "),r=s.slice(e+1,d),n=s.slice(d+1,-1);t[r]=n}r+=o}return t}let T;if("string"==typeof g){const e=await fetch(g,t.fetchInit);if(!e.ok)throw new Error("Fetching of URL failed.");T=e.body}else if(g&&"function"==typeof g.stream)T=g.stream();else throw new Error("Invalid source.");const I=T.getReader(),A=[];let x=0;for(;8>x;){const{value:e,done:t}=await I.read();if(t)break;A.push(e),x+=e.byteLength}I.releaseLock();let L=0;const K=new ReadableStream({async start(t){for(const e of A)t.enqueue(e);const r=T.getReader();try{for(;;){const{value:e,done:n}=await r.read();if(n)break;t.enqueue(e)}t.close()}catch(r){t.error(r)}}}),U=new Uint8Array(8);if(0<x){let e=0;for(const t of A){const r=8-e;if(0>=r)break;const n=Math.min(r,t.byteLength);U.set(t.subarray(0,n),e),e+=n}}const z=b.decode(U.slice(0,6));let D;if("LE_ENC"===z){if(null===l.password)throw new Error("A password is required to decrypt this data.");let e=l.password||prompt("Enter the password:");if(!e)throw new Error("A password is required to decrypt this data.");D=new R(K,e,S).readable().pipeThrough(new DecompressionStream("gzip"))}else D=31===U[0]&&139===U[1]?K.pipeThrough(new DecompressionStream("gzip")):K;D=D.pipeThrough(new TransformStream({transform(e,t){L+=e.byteLength,t.enqueue(e)}}));const _=D.getReader(),W=new O;let N=!1,j=0;E=!1!==l.opfs&&navigator.storage?await navigator.storage.getDirectory():null;let q;try{E&&(q=await E.getDirectoryHandle(m,{create:!0}))}catch(t){}const H=new Set;for(let t=null;!P;){const g=await e(512);if(!g){if(!1!==l.verifyFile&&!B)if(0<j&&0===W.totalSize)LittleExport.warn("Warning: Stream ended without standard EOF blocks. Import likely successful.");else throw new Error("Archive truncated: Stream ended prematurely.");break}const m=W.read(512);if(!1!==l.verifyFile&&0===m[0]&&m.every(e=>0===e)){B=!0;continue}if(!1!==l.verifyFile&&!s(m)){if(0<j&&0===W.totalSize&&N)break;throw new Error("Corrupt TAR header: Checksum mismatch.")}let T=b.decode(m.slice(0,100)).replace(/\0/g,"").trim();const O=m[156],R=b.decode(m.slice(124,136)).replace(/\0/g,"").trim(),I=parseInt(R,8)||0,A=(512-I%512)%512;if(120===O){if(!(await e(I)))throw new Error("Unexpected EOF.");const r=W.read(I);await d(A),t=k(r);continue}let x=I;if(t&&(t.path&&(T=t.path),t.size&&(x=parseInt(t.size,10)),t=null),j++,T.startsWith("data/idb/")){C.category="IndexedDB";const e=T.split("/");C.detail=e[2]?decodeURIComponent(e[2]):"data"}else if(T.startsWith("data/cache/")){C.category="Cache";const e=T.split("/");C.detail=e[2]?decodeURIComponent(e[2]):"item"}else T.startsWith("opfs/")?(C.category="OPFS",C.detail=T.replace("opfs/","")):T.startsWith("data/blobs/")?(C.category="Blobs",C.detail="restoring..."):(C.category="Config",C.detail=T);const K=S();if(K&&(C.category&&y(`Importing ${C.category}: ${(L/1e6).toFixed(2)} MB (${C.detail})`),await K),T.startsWith("data/")){if(T.startsWith("data/blobs/")){const e=T.split("/").pop();if(q){let t=!1;await a(async()=>{const r=await q.getFileHandle(e,{create:!0});await p(await r.createWritable(),x),t=!0},`Blob ${e}`),t||(await d(x))}else await d(x);await d(A);continue}else{if(0===x){await d(A);continue}if(!(await e(x)))throw new Error("Unexpected EOF for metadata.");const t=W.read(x);if("data/ls.json"===T&&!1!==l.localStorage){if(await o(u.LS,null,null,"localStorage")){const e=JSON.parse(b.decode(t)),a=F.localStorage===f.TRUST;for(const t in e){if(P)break;let o=a;if(!o)if(w){let r=n(u.LS,[t],{value:e[t]});if(r&&"function"==typeof r.then&&(r=await r),r===f.ABORT){P=!0;break}o=r!==f.SKIP}else o=r("localStorage",t,l);o&&localStorage.setItem(t,e[t])}}}else if("data/ss.json"===T&&!1!==l.session){if(await o(u.SS,null,null,"session")){const e=JSON.parse(b.decode(t)),a=F.session===f.TRUST;for(const t in e){if(P)break;let o=a;if(!o)if(w){let r=n(u.SS,[t],{value:e[t]});if(r&&"function"==typeof r.then&&(r=await r),r===f.ABORT){P=!0;break}o=r!==f.SKIP}else o=r("session",t,l);o&&sessionStorage.setItem(t,e[t])}}}else if("data/cookies.json"===T&&!1!==l.cookies){if(await o(u.COOKIE,null,null,"cookies")){const e=JSON.parse(b.decode(t)),a=F.cookies===f.TRUST;for(const t in e){if(P)break;let o=a;if(!o)if(w){let r=n(u.COOKIE,[t],{value:e[t]});if(r&&"function"==typeof r.then&&(r=await r),r===f.ABORT){P=!0;break}o=r!==f.SKIP}else o=r("cookies",t,l);o&&(document.cookie=`${t}=${e[t]}; path=/; max-age=31536000`)}}}else if(T.startsWith("data/custom/")&&l.onCustomItem)await l.onCustomItem(T.replace("data/custom/",""),t);else if(T.startsWith("data/idb/")&&i&&!1!==l.idb){const e=T.split("/"),r=decodeURIComponent(e[2]);if(T.endsWith("schema."+h)){if(!(await o(u.IDB,[r],r,"idb")))continue;const n=c.decode(t);H.add(r),v[r]&&(v[r].close(),delete v[r]),await a(async()=>{await new Promise(e=>{const t=indexedDB.deleteDatabase(n.name);t.onsuccess=e,t.onerror=e}),await new Promise((t,r)=>{const a=indexedDB.open(n.name,n.version);a.onupgradeneeded=t=>{const e=t.target.result;n.stores.forEach(t=>{if(!e.objectStoreNames.contains(t.name)){const r=e.createObjectStore(t.name,{keyPath:t.keyPath,autoIncrement:t.autoIncrement});t.indexes.forEach(e=>r.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry}))}})},a.onsuccess=r=>{r.target.result.close(),t()},a.onerror=r})},`IDB schema ${r}`)}else{const n=decodeURIComponent(e[3]);if(!H.has(r))continue;if(!(await o(u.IDB,[r,n],`${r}/${n}`,"idb")))continue;const i=c.decode(t),[s,d]=await LittleExport.restoreFromCBOR(i,q);if(!v[r]){const e=await a(async()=>await new Promise((e,t)=>{const n=indexedDB.open(r),a=setTimeout(()=>t(new Error(`Database ${r} timed out.`)),5e3);n.onblocked=()=>{clearTimeout(a),t(new Error(`Database ${r} blocked.`))},n.onsuccess=()=>{clearTimeout(a),e(n.result)},n.onerror=()=>{clearTimeout(a),t(n.error)}}),`Opening IDB ${r}`);if(!e)continue;v[r]=e}await a(async()=>{const e=v[r].transaction(n,"readwrite"),t=e.objectStore(n);for(let e=0;e<s.length;e++)t.put(d[e],t.keyPath?void 0:s[e]);await new Promise((t,r)=>{e.oncomplete=t,e.onerror=()=>r(e.error),e.onabort=()=>r(new Error("Transaction aborted."))})},`IDB ${r}/${n}`)}}else if(T.startsWith("data/cache/")&&i&&!1!==l.cache){const e=T.split("/"),r=decodeURIComponent(e[2]);(await o(u.CACHE,[r],r,"cache"))&&(await a(async()=>{const e=c.decode(t),n=await caches.open(r),a=await LittleExport.restoreFromCBOR(e.data,q),o=a instanceof Blob?a:new Blob([a]),i=new Response(o,{status:e.meta.status,headers:e.meta.headers});await n.put(e.meta.url,i)},`Cache ${r}`))}}}else if(!1!==l.opfs){const e=T.startsWith("opfs/")?T.slice(5):T,t=e.endsWith("/")||53===m[156],r=e.replace(/\/$/,""),n=r.split("/").filter(e=>e.length);if(0<n.length){const e=[...n];(await o(u.OPFS,e,r,"opfs"))?await a(async()=>{let e=E;if(t)for(const t of n)e=await e.getDirectoryHandle(t,{create:!0});else{const t=n[n.length-1],r=n.slice(0,-1);for(const t of r)e=await e.getDirectoryHandle(t,{create:!0});const a=await e.getFileHandle(t,{create:!0});if(0<x)await p(await a.createWritable(),x);else{const e=await a.createWritable();await e.close()}}},`OPFS ${r}`):await d(x)}else await d(x)}else await d(x);await d(A)}Object.values(v).forEach(e=>e.close()),P||y("Import complete!")}catch(t){if(Object.values(v).forEach(e=>{try{e.close()}catch(t){}}),y(`Error: ${t.message}`),l.onerror&&l.onerror(t),!k)throw t}finally{if(E)try{await E.removeEntry(m,{recursive:!0})}catch(t){}}}function l(e,t){const{readable:r,writable:n}=new TransformStream,a=new w(n,t);return(async()=>{try{if(window.FileSystemDirectoryHandle&&e instanceof FileSystemDirectoryHandle){async function t(e,r){for await(const[n,o]of e.entries()){if("directory"===o.kind&&"PaxHeaders"===n)continue;const e=r?`${r}/${n}`:n;if("file"===o.kind){const t=await o.getFile();await a.writeStream(e,t.size,t.stream())}else"directory"===o.kind&&(await a.writeDir(e),await t(o,e))}}await t(e,"")}else if(e instanceof FileList||Array.isArray(e)&&e[0]instanceof File){const t=Array.from(e),r=t[0].webkitRelativePath,n=r?r.split("/")[0]+"/":"";for(const e of t){let t=e.webkitRelativePath;t.startsWith(n)&&(t=t.slice(n.length)),t||(t=e.name),await a.writeStream(t,e.size,e.stream())}}await a.close()}catch(t){try{await n.abort(t)}catch(t){}}})(),r}const u={OPFS:1,IDB:2,LS:4,SS:8,COOKIE:16,CACHE:32},f={SKIP:0,PROCESS:1,TRUST:2,ABORT:3};let h=0;const g=4194304,y=65536,p=new TextEncoder,b=new TextDecoder("utf-8",{fatal:!1}),m=".rfs_temp_blobs",S={USTAR_MAGIC:new Uint8Array([117,115,116,97,114,0]),USTAR_VER:new Uint8Array([48,48]),EMPTY_SPACE:new Uint8Array(8).fill(32)},k=new Uint8Array(512);(function(){const e=(e,t)=>p.encodeInto(e,k.subarray(t));e("000644 \0",100),e("000000 \0",108),e("000000 \0",116),k.set(S.EMPTY_SPACE,148),k[156]=48,k.set(S.USTAR_MAGIC,257),k.set(S.USTAR_VER,263)})();class w{constructor(e,t){this.writer=e.getWriter(),this.yielder=t,this.pos=0,this.time=Math.floor(Date.now()/1e3),this.buffer=new Uint8Array(y),this.bufferOffset=0}async writeEntry(e,t){const r="string"==typeof t?p.encode(t):t,n=r.byteLength;this.onFileProgress&&this.onFileProgress(0,n),await this.smartWrite(e,n,async()=>{await this.write(r)}),this.onFileProgress&&this.onFileProgress(n,n)}async writeStream(e,t,r){let n=0;await this.flush(),await this.smartWrite(e,t,async()=>{const e=r.getReader();try{for(;;){const{done:r,value:a}=await e.read();if(r)break;if(a){const e=t-n;if(0>=e)continue;const r=a.byteLength>e?a.subarray(0,e):a;await this.write(r),n+=r.byteLength,this.onFileProgress&&this.onFileProgress(n,t)}const o=this.yielder();o&&(await o)}if(n<t){const e=t-n,r=new Uint8Array(e);await this.write(r)}}finally{e.releaseLock()}})}async smartWrite(e,t,r){const n=p.encode(e),a=100<n.length||8589934591<t;if(a){const r=o(e,t),n="PaxHeaders/"+(50<e.length?e.slice(0,50):e);await this.write(i(n,r.length,this.time,"x")),await this.write(r),await this.pad()}await this.write(i(e,t,this.time,0===t&&e.endsWith("/")?"5":"0")),r&&(await r()),await this.pad()}async writeDir(e){e.endsWith("/")||(e+="/");const t=p.encode(e),r=100<t.length;if(r){const t=o(e,0),r="PaxHeaders/"+(50<e.length?e.slice(0,50):e);await this.write(i(r,t.length,this.time,"x")),await this.write(t),await this.pad()}const n=i(e,0,this.time,"5","000755");await this.write(n)}async write(e){const t=e.byteLength;t>=y?(await this.flush(),await this.writer.write(e)):this.bufferOffset+t>y?(await this.flush(),this.buffer.set(e,0),this.bufferOffset=t):(this.buffer.set(e,this.bufferOffset),this.bufferOffset+=t),this.pos+=t}async pad(){const e=(512-this.pos%512)%512;0<e&&(await this.write(new Uint8Array(e)))}async flush(){0<this.bufferOffset&&(await this.writer.write(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0)}async close(){await this.write(new Uint8Array(1024)),await this.flush(),await this.writer.close()}}class T{constructor(e,r){this.salt=r,this.keyPromise=t(e,r),this.chunks=[],this.currentSize=0}async start(e){e.enqueue(p.encode("LE_ENC")),e.enqueue(this.salt),await this.encryptAndPush(new Uint8Array(0),e,await this.keyPromise)}async transform(e,t){if(this.chunks.push(e),this.currentSize+=e.byteLength,this.currentSize>=g){const e=new Uint8Array(this.currentSize);let r=0;for(const t of this.chunks)e.set(t,r),r+=t.byteLength;const n=await this.keyPromise;let a=0;for(;a+g<=e.length;)await this.encryptAndPush(e.subarray(a,a+g),t,n),a+=g;const o=e.subarray(a);this.chunks=0<o.length?[o]:[],this.currentSize=o.length}}async flush(e){if(0<this.currentSize){const t=new Uint8Array(this.currentSize);let r=0;for(const e of this.chunks)t.set(e,r),r+=e.byteLength;await this.encryptAndPush(t,e,await this.keyPromise)}}async encryptAndPush(e,t,r){const n=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,e),o=new DataView(new ArrayBuffer(4));o.setUint32(0,a.byteLength,!0),t.enqueue(n),t.enqueue(new Uint8Array(o.buffer)),t.enqueue(new Uint8Array(a))}}class O{constructor(){this.chunks=[],this.totalSize=0,this.offset=0}push(e){e&&0!==e.byteLength&&(this.chunks.push(e),this.totalSize+=e.byteLength)}has(e){return this.totalSize>=e}_internalConsume(e,t){for(let r=0;r<e&&0<this.chunks.length;){const n=this.chunks[0],a=n.byteLength-this.offset,o=e-r,i=Math.min(a,o);t(n.subarray(this.offset,this.offset+i)),this.offset+=i,this.offset>=n.byteLength&&(this.chunks.shift(),this.offset=0),this.totalSize-=i,r+=i}}read(e){if(0===e)return new Uint8Array(0);if(this.totalSize<e)throw new Error("Insufficient chunk data.");if(0<this.chunks.length&&this.chunks[0].byteLength-this.offset>=e){const t=this.chunks[0].subarray(this.offset,this.offset+e);return this.offset+=e,this.offset>=this.chunks[0].byteLength&&(this.chunks.shift(),this.offset=0),this.totalSize-=e,t}const t=new Uint8Array(e);let r=0;return this._internalConsume(e,e=>{t.set(e,r),r+=e.byteLength}),t}async consume(e,t){for(let r=e;0<r&&0<this.chunks.length;){const e=this.chunks[0],n=e.byteLength-this.offset,a=Math.min(n,r);await t(e.subarray(this.offset,this.offset+a)),this.offset+=a,this.offset>=e.byteLength&&(this.chunks.shift(),this.offset=0),this.totalSize-=a,r-=a}}}class R{constructor(e,t,r){this.stream=e,this.password=t,this.yielder=r,this.buffer=new O}readable(){async function e(e){for(;!r.buffer.has(e);){const{value:e,done:t}=await n.read();if(t)return!1;r.buffer.push(e)}return!0}const r=this;let n;return new ReadableStream({async start(a){n=r.stream.getReader();try{if(!(await e(22)))throw new Error("Not an encrypted archive.");const o=b.decode(r.buffer.read(6));if("LE_ENC"!==o)throw new Error("Not an encrypted archive.");const i=r.buffer.read(16),s=await t(r.password,i);if(!(await e(16)))throw new Error("Corrupt header.");const d=r.buffer.read(12),l=r.buffer.read(4),c=new DataView(l.buffer,l.byteOffset,l.byteLength).getUint32(0,!0);if(16!==c||!(await e(c)))throw new Error("Corrupt header.");const u=r.buffer.read(c);try{await crypto.subtle.decrypt({name:"AES-GCM",iv:d},s,u)}catch(t){throw new Error("Incorrect password or corrupt file.")}for(;;){const e=r.yielder();if(e&&(await e),!r.buffer.has(16)){const{value:e,done:t}=await n.read();if(t){if(0===r.buffer.totalSize)break;throw new Error("Truncated encrypted stream.")}r.buffer.push(e);continue}const t=r.buffer.read(12),o=r.buffer.read(4),i=new DataView(o.buffer,o.byteOffset,o.byteLength).getUint32(0,!0);for(;!r.buffer.has(i);){const{value:e,done:t}=await n.read();if(t)throw new Error("Unexpected EOF in ciphertext.");r.buffer.push(e);const a=r.yielder();a&&(await a)}const d=r.buffer.read(i),l=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},s,d),c=r.yielder(!0);c&&(await c),a.enqueue(new Uint8Array(l))}a.close()}catch(t){a.error(t)}finally{n.releaseLock()}}})}}window.LittleExport={importData:d,exportData:async function(t={}){function n(e,t,r){return b?m(e,t,r):f.TRUST}async function a(e,t){try{return await e()}catch(r){if(y)return s.onerror&&s.onerror(r),c(`Error: ${t} - ${r.message}`),null;throw r}}h=0;const o=window.CBOR,s={fileName:"archive",logSpeed:100,customItems:[],include:{},exclude:{},cborExtensionName:"cbor",...t},d=s.encoder||new o.Encoder({structuredClone:!0,copyBuffers:!1,bundleStrings:!0,...s.cborOptions}),l=s.cborExtensionName,c=s.logger||(()=>{}),g=e(s.logSpeed),y=!1!==s.graceful,b="function"==typeof s.onVisit,m=s.onVisit;let S=!1;const O={category:"",detail:""};let R,P=[];if(window.showSaveFilePicker&&!1!==s.download)try{const e=s.password?`${s.fileName}.enc`:`${s.fileName}.tar.gz`,t=await window.showSaveFilePicker({suggestedName:e});R=await t.createWritable()}catch(t){if("AbortError"===t.name)return void c("Export cancelled.");LittleExport.warn("FileSystem picker failed, falling back.")}R||(R=new WritableStream({write(e){P.push(e)},close(){}}));let E=0;const F=new TransformStream({async transform(e,t){E+=e.byteLength;const r=g();if(r){if(O.category)if("Finishing"===O.category)c("Finishing...");else{let e=`Exporting ${O.category}: ${(E/1e6).toFixed(2)} MB`;e+=1e6<v.total?` (${O.detail}: ${(v.written/1e6).toFixed(1)}/${(v.total/1e6).toFixed(1)} MB)`:` (${O.detail})`,c(e)}await r}t.enqueue(e)}}),I=new CompressionStream("gzip");let C=I.readable;if(s.password){O.category="Setup",O.detail="Encrypting...";const e=crypto.getRandomValues(new Uint8Array(16));C=C.pipeThrough(new TransformStream(new T(s.password,e)))}let v={written:0,total:0};const B=C.pipeThrough(F).pipeTo(R),A=new w(I.writable,g);A.onFileProgress=(e,t)=>{v.written=e,v.total=t};try{for(const e of s.customItems){if(S)break;O.category="custom",O.detail=e.path;const t=`data/custom/${e.path}`;e.data instanceof Blob?await A.writeStream(t,e.data.size,e.data.stream()):await A.writeEntry(t,"string"==typeof e.data?e.data:JSON.stringify(e.data))}if(!S&&s.opfs&&navigator.storage){let e=n(u.OPFS);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){async function t(e,o,i){try{for await(const d of e.values()){if(S)return;v.written=0,v.total=0;const e=[...o,d.name],l=e.join("/");let c=i;if(O.detail=l,!i)if(b){let t=n(u.OPFS,e,{kind:d.kind,handle:d});if(t&&"function"==typeof t.then&&(t=await t),c=t,c===f.ABORT)return void(S=!0);if(c===f.SKIP)continue}else{if(!r("opfs",l,s))continue;c=f.TRUST}const h=c===f.TRUST;"file"===d.kind?await a(async()=>{const e=await d.getFile();await A.writeStream(`opfs/${l}`,e.size,e.stream())},`OPFS file ${l}`):(await A.writeDir(`opfs/${l}`),await t(d,e,!!h&&f.TRUST));const y=g();y&&(await y)}}catch(t){if(c(`Error: accessing OPFS folder /${o.join("/")} failed (${t.message})`),s.onerror&&s.onerror(t),!y)throw t}}O.category="OPFS";const o=await navigator.storage.getDirectory(),i=e===f.TRUST;await t(o,[],!!i&&f.TRUST)}}if(!S&&s.idb&&window.indexedDB&&o){let e=n(u.IDB);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){O.category="IndexedDB";const t=e===f.TRUST,o=await window.indexedDB.databases();for(const{name:e,version:i}of o){if(S)break;v.written=0,v.total=0,O.detail=e;const o=encodeURIComponent(e),c=await a(async()=>await new Promise((t,r)=>{const n=indexedDB.open(e),a=setTimeout(()=>r(new Error(`Database ${e} timed out.`)),5e3);n.onblocked=()=>{clearTimeout(a),r(new Error(`Database ${e} blocked.`))},n.onsuccess=()=>{clearTimeout(a),t(n.result)},n.onerror=()=>{clearTimeout(a),r(n.error)}}),`Opening IDB ${e}`);if(!c)continue;let h=t?f.TRUST:f.PROCESS;if(!t)if(b){let t=n(u.IDB,[e],{database:c});if(t&&"function"==typeof t.then&&(t=await t),h=t,h===f.ABORT){S=!0,c.close();break}if(h===f.SKIP){c.close();continue}}else if(!r("idb",e,s)){c.close();continue}const y=h===f.TRUST;try{const t=Array.from(c.objectStoreNames);if(0===t.length){await A.writeEntry(`data/idb/${o}/schema.${l}`,d.encode({name:e,version:i,stores:[]}));continue}const h=[],p=c.transaction(t,"readonly");for(const e of t){const t=p.objectStore(e);h.push({name:e,keyPath:t.keyPath,autoIncrement:t.autoIncrement,indexes:Array.from(t.indexNames).map(e=>{const r=t.index(e);return{name:r.name,keyPath:r.keyPath,unique:r.unique,multiEntry:r.multiEntry}})})}await A.writeEntry(`data/idb/${o}/schema.${l}`,d.encode({name:e,version:i,stores:h}));for(const i of t){if(S)break;let t=y?f.TRUST:f.PROCESS;if(!y)if(b){let r=n(u.IDB,[e,i],{database:c});if(r&&"function"==typeof r.then&&(r=await r),t=r,t===f.ABORT){S=!0;break}if(t===f.SKIP)continue}else if(!r("idb",`${e}/${i}`,s))continue;O.detail=`${e}/${i}`;let h=null,m=0,k=!0;for(;k&&!S;){const t=await a(async()=>{return await new Promise((t,r)=>{const n=c.transaction(i,"readonly"),a=n.objectStore(i),o=null===h?null:IDBKeyRange.lowerBound(h,!0),s=a.openCursor(o),d=[],l=[];s.onsuccess=r=>{const e=r.target.result;e&&d.length<25?(d.push(e.key),l.push(e.value),h=e.key,e.continue()):t({keys:d,values:l,done:!e})},s.onerror=()=>r(s.error)})},`Reading IDB ${e}/${i}`);if(!t)break;if(k=!t.done,0<t.keys.length){const e=[];for(let r=0;r<t.values.length;r++){const n=[],a=LittleExport.prepForCBOR(t.values[r],n);e.push(a);for(const e of n)await A.writeStream(`data/blobs/${e.uuid}`,e.blob.size,e.blob.stream())}await A.writeEntry(`data/idb/${o}/${encodeURIComponent(i)}/${m++}.${l}`,d.encode([t.keys,e]));const r=g();r&&(await r)}}}}finally{c.close()}}}}if(!S&&s.localStorage){let e=n(u.LS);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){O.category="Storage";const t={},a=e===f.TRUST;for(let e=0;e<localStorage.length&&!S;e++){const o=localStorage.key(e);O.detail=`localStorage: ${o}`;let i=a;if(!i)if(b){let e=n(u.LS,[o],{value:localStorage.getItem(o)});if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT){S=!0;break}i=e!==f.SKIP}else i=r("localStorage",o,s);i&&(t[o]=localStorage.getItem(o))}!S&&0<Object.keys(t).length&&(await A.writeEntry("data/ls.json",JSON.stringify(t)))}}if(!S&&s.session){let e=n(u.SS);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){O.category="Storage";const t={},a=e===f.TRUST;for(let e=0;e<sessionStorage.length&&!S;e++){const o=sessionStorage.key(e);O.detail=`sessionStorage: ${o}`;let i=a;if(!i)if(b){let e=n(u.SS,[o],{value:sessionStorage.getItem(o)});if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT){S=!0;break}i=e!==f.SKIP}else i=r("session",o,s);i&&(t[o]=sessionStorage.getItem(o))}!S&&0<Object.keys(t).length&&(await A.writeEntry("data/ss.json",JSON.stringify(t)))}}if(!S&&s.cookies){let e=n(u.COOKIE);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){O.category="Storage";const t={},a=e===f.TRUST,o=document.cookie.split(";").map(e=>e.trim()).filter(Boolean);for(const e of o){if(S)break;const o=e.indexOf("="),i=-1<o?e.slice(0,o).trim():e.trim(),d=-1<o?e.slice(o+1).trim():"";if(!i)continue;O.detail=`Cookie: ${i}`;let l=a;if(!l)if(b){let e=n(u.COOKIE,[i],{value:d});if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT){S=!0;break}l=e!==f.SKIP}else l=r("cookies",i,s);l&&(t[i]=d)}!S&&0<Object.keys(t).length&&(await A.writeEntry("data/cookies.json",JSON.stringify(t)))}}if(!S&&s.cache&&window.caches&&o){let e=n(u.CACHE);if(e&&"function"==typeof e.then&&(e=await e),e===f.ABORT&&(S=!0),!S&&e!==f.SKIP){O.category="Cache";const t=await caches.keys(),o=e===f.TRUST;for(const e of t){if(S)break;v.written=0,v.total=0;let t=o;if(!t)if(b){let r=n(u.CACHE,[e],null);if(r&&"function"==typeof r.then&&(r=await r),r===f.ABORT){S=!0;break}t=r!==f.SKIP}else t=r("cache",e,s);if(!t)continue;O.detail=e;const i=g();i&&(await i),await a(async()=>{const t=await caches.open(e);for(const r of await t.keys()){const n=await t.match(r);if(!n)continue;const a=await n.blob(),o=btoa(r.url).slice(0,50).replace(/\//g,"_"),i=[],s=LittleExport.prepForCBOR(a,i);for(const e of i)await A.writeStream(`data/blobs/${e.uuid}`,e.blob.size,e.blob.stream());await A.writeEntry(`data/cache/${encodeURIComponent(e)}/${o}.${l}`,d.encode({meta:{url:r.url,status:n.status,headers:Object.fromEntries(n.headers),type:a.type},data:s}))}},`Cache ${e}`)}}}O.category="Finishing",await A.close(),await B;let e=null;if(0<P.length&&(e=new Blob(P,{type:"application/octet-stream"})),!1!==s.download){if(e){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t;let n=s.fileName;r.download=n.includes(".")?n:s.password?`${n}.enc`:`${n}.tar.gz`,r.click(),setTimeout(()=>URL.revokeObjectURL(t),1e3)}return c("Export complete!"),null}return c("Export complete!"),e}catch(t){try{await R.abort(t).catch(()=>{})}catch(t){}if(c(`Error: ${t.message}`),s.onerror&&s.onerror(t),!y)throw t}},deriveKey:t,prepForCBOR:n,restoreFromCBOR:a,importFromFolder:async function(t={}){const r={...t},n=e(r.logSpeed);let a=r.logger||(()=>{});const o=e=>d({...r,source:{stream:()=>e}});if(window.showDirectoryPicker&&!0!==r.legacy)try{const e=await window.showDirectoryPicker(),t=l(e,n);return await o(t)}catch(t){if("AbortError"===t.name)return void a("User cancelled the directory picker.");a("Directory Picker failed, falling back to legacy input."),LittleExport.warn("Directory Picker failed, falling back to legacy input.",t)}return new Promise((e,t)=>{const r=document.createElement("input");r.type="file",r.webkitdirectory=!0,r.multiple=!0,r.style.display="none",document.body.appendChild(r),r.onchange=async()=>{if(!r.files||0===r.files.length)return void e();try{const t=l(r.files,n);await o(t),e()}catch(r){t(r)}finally{document.body.removeChild(r)}},r.oncancel=()=>{document.body.removeChild(r),e()},r.click()})},folderToTarStream:l,clearData:async function(e={}){if(0===Object.keys(e).length&&(e={opfs:!0,idb:!0,localStorage:!0,session:!0,cookies:!0,cache:!0}),e.opfs&&navigator.storage)try{const e=await navigator.storage.getDirectory();for await(const t of e.keys())await e.removeEntry(t,{recursive:!0})}catch(t){LittleExport.warn("Failed to clear OPFS:",t)}if(e.localStorage)try{localStorage.clear()}catch(t){LittleExport.warn("Failed to clear localStorage:",t)}if(e.session)try{sessionStorage.clear()}catch(t){LittleExport.warn("Failed to clear sessionStorage:",t)}if(e.cookies)try{const e=document.cookie.split(";");for(let t=0;t<e.length;t++){const r=e[t],n=r.indexOf("="),a=-1<n?r.trim().substring(0,n):r.trim();document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`,document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; domain=${window.location.hostname}; path=/`;const o=window.location.hostname.split(".");if(2<o.length){const e=o.slice(-2).join(".");document.cookie=`${a}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; domain=.${e}; path=/`}}}catch(t){LittleExport.warn("Failed to clear cookies:",t)}if(e.cache&&window.caches)try{const e=await caches.keys();for(const t of e)await caches.delete(t)}catch(t){LittleExport.warn("Failed to clear cache:",t)}if(e.idb&&window.indexedDB)try{const e=await window.indexedDB.databases();for(const{name:t}of e)indexedDB.deleteDatabase(t)}catch(t){LittleExport.warn("Failed to clear IndexedDB:",t)}},TYPE:u,warn:console.warn,DECISION:f}})();